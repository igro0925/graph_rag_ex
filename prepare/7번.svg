<svg viewBox="0 0 1200 1800" xmlns="http://www.w3.org/2000/svg">
  <!-- 정의 섹션 -->
  <defs>
    <!-- 그라디언트 정의 -->
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="resultGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>
    
    <!-- 화살표 마커 -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- 제목 -->
  <rect x="50" y="20" width="1100" height="60" rx="10" fill="url(#headerGrad)"/>
  <text x="600" y="55" font-size="24" font-weight="bold" text-anchor="middle" fill="white">
    Graph-based RAG System 실행 흐름도
  </text>
  
  <!-- 1. 사용자 쿼리 입력 -->
  <rect x="450" y="120" width="300" height="60" rx="10" fill="#f0f0f0" stroke="#333" stroke-width="2"/>
  <text x="600" y="155" font-size="16" font-weight="bold" text-anchor="middle">사용자 쿼리 입력</text>
  <text x="600" y="175" font-size="12" text-anchor="middle" fill="#666">"2차 세계대전 영화 찾기"</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="180" x2="600" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 2. 벡터 검색 단계 -->
  <rect x="400" y="220" width="400" height="80" rx="10" fill="url(#processGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="250" font-size="16" font-weight="bold" text-anchor="middle" fill="white">1단계: 벡터 유사도 검색</text>
  <text x="600" y="270" font-size="13" text-anchor="middle" fill="white">graph_vector.similarity_search()</text>
  <text x="600" y="290" font-size="12" text-anchor="middle" fill="#e0e0e0">text-embedding-3-small 모델 사용</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="300" x2="600" y2="340" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 3. Neo4j 벡터 검색 -->
  <rect x="350" y="340" width="500" height="100" rx="10" fill="url(#dbGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="370" font-size="16" font-weight="bold" text-anchor="middle">Neo4j 벡터 인덱스 쿼리</text>
  <text x="600" y="395" font-size="13" text-anchor="middle">"movie_content_embeddings" 인덱스</text>
  <text x="600" y="415" font-size="12" text-anchor="middle" fill="#333">→ 유사한 영화 k=5개 반환</text>
  <text x="600" y="432" font-size="11" text-anchor="middle" fill="#555">영화 제목(title) 추출</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="440" x2="600" y2="480" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 4. 영화-배우 관계 쿼리 -->
  <rect x="300" y="480" width="600" height="120" rx="10" fill="url(#processGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="510" font-size="16" font-weight="bold" text-anchor="middle" fill="white">2단계: 영화-배우 관계 조회</text>
  <text x="600" y="535" font-size="13" text-anchor="middle" fill="white">Cypher Query 실행</text>
  <text x="600" y="555" font-size="11" text-anchor="middle" fill="#e0e0e0">MATCH (movie:Movie)&lt;-[ACTED_IN]-(actor:Person)</text>
  <text x="600" y="575" font-size="12" text-anchor="middle" fill="#e0e0e0">→ 영화 정보 + 출연 배우 목록</text>
  <text x="600" y="592" font-size="11" text-anchor="middle" fill="#e0e0e0">배우 ID 추출 및 중복 제거</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="600" x2="600" y2="640" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 5. 배우 필모그래피 쿼리 -->
  <rect x="300" y="640" width="600" height="120" rx="10" fill="url(#dbGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="670" font-size="16" font-weight="bold" text-anchor="middle">3단계: 배우 필모그래피 확장</text>
  <text x="600" y="695" font-size="13" text-anchor="middle">Cypher Query 실행</text>
  <text x="600" y="715" font-size="11" text-anchor="middle" fill="#333">MATCH (actor)-[:ACTED_IN]->(movie:Movie)</text>
  <text x="600" y="735" font-size="11" text-anchor="middle" fill="#333">WHERE NOT movie.title IN $movie_titles</text>
  <text x="600" y="752" font-size="12" text-anchor="middle" fill="#555">→ 각 배우의 다른 출연작 목록</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="760" x2="600" y2="800" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 6. 결과 포맷팅 -->
  <rect x="350" y="800" width="500" height="100" rx="10" fill="url(#resultGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="830" font-size="16" font-weight="bold" text-anchor="middle">결과 포맷팅</text>
  <text x="600" y="855" font-size="13" text-anchor="middle">1. 검색된 영화 정보 (제목, 평점, 배우)</text>
  <text x="600" y="875" font-size="13" text-anchor="middle">2. 출연 배우의 다른 작품 (필모그래피)</text>
  <text x="600" y="892" font-size="11" text-anchor="middle" fill="#333">→ Markdown 형식으로 구조화</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="900" x2="600" y2="940" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 7. RAG 체인 실행 -->
  <rect x="250" y="940" width="700" height="140" rx="10" fill="url(#processGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="970" font-size="16" font-weight="bold" text-anchor="middle" fill="white">4단계: RAG 체인 실행</text>
  <text x="600" y="995" font-size="13" text-anchor="middle" fill="white">context: 포맷팅된 검색 결과</text>
  <text x="600" y="1015" font-size="13" text-anchor="middle" fill="white">question: 사용자 원본 쿼리</text>
  <text x="600" y="1040" font-size="12" text-anchor="middle" fill="#e0e0e0">↓</text>
  <text x="600" y="1060" font-size="13" text-anchor="middle" fill="white">Prompt Template → GPT-4o-mini → 답변 생성</text>
  <text x="600" y="1075" font-size="11" text-anchor="middle" fill="#e0e0e0">(주어진 정보만 활용한 객관적 답변)</text>
  
  <!-- 화살표 -->
  <line x1="600" y1="1080" x2="600" y2="1120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 8. 최종 답변 -->
  <rect x="400" y="1120" width="400" height="80" rx="10" fill="url(#resultGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="1150" font-size="16" font-weight="bold" text-anchor="middle">최종 사용자 답변</text>
  <text x="600" y="1175" font-size="13" text-anchor="middle">영화 추천 + 배우 정보 +</text>
  <text x="600" y="1192" font-size="13" text-anchor="middle">관련 작품 소개</text>
  
  <!-- 왼쪽 데이터 플로우 박스 -->
  <rect x="50" y="350" width="220" height="280" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="160" y="380" font-size="14" font-weight="bold" text-anchor="middle">📊 데이터 플로우</text>
  <text x="70" y="410" font-size="11" fill="#333">• 쿼리 → 임베딩 벡터</text>
  <text x="70" y="435" font-size="11" fill="#333">• 벡터 → 유사 영화</text>
  <text x="70" y="460" font-size="11" fill="#333">• 영화 → 출연 배우</text>
  <text x="70" y="485" font-size="11" fill="#333">• 배우 → 필모그래피</text>
  <text x="70" y="510" font-size="11" fill="#333">• 그래프 확장</text>
  <text x="70" y="540" font-size="10" fill="#666">검색 범위:</text>
  <text x="70" y="560" font-size="10" fill="#666">1홉 → 2홉 확장</text>
  <text x="70" y="580" font-size="10" fill="#666">(영화 → 배우 → 다른영화)</text>
  <text x="70" y="610" font-size="9" font-style="italic" fill="#999">벡터 검색 + 그래프 탐색</text>
  
  <!-- 오른쪽 주요 컴포넌트 박스 -->
  <rect x="930" y="350" width="220" height="320" rx="8" fill="#d1ecf1" stroke="#0c5460" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="1040" y="380" font-size="14" font-weight="bold" text-anchor="middle">🔧 핵심 컴포넌트</text>
  
  <text x="950" y="415" font-size="12" font-weight="bold" fill="#0c5460">벡터 검색:</text>
  <text x="950" y="435" font-size="10" fill="#333">Neo4jVector</text>
  <text x="950" y="450" font-size="10" fill="#333">OpenAI Embeddings</text>
  
  <text x="950" y="480" font-size="12" font-weight="bold" fill="#0c5460">그래프 쿼리:</text>
  <text x="950" y="500" font-size="10" fill="#333">Neo4jGraph</text>
  <text x="950" y="515" font-size="10" fill="#333">Cypher Query</text>
  
  <text x="950" y="545" font-size="12" font-weight="bold" fill="#0c5460">LLM 생성:</text>
  <text x="950" y="565" font-size="10" fill="#333">ChatOpenAI (GPT-4o-mini)</text>
  <text x="950" y="580" font-size="10" fill="#333">Temperature: 0.0</text>
  
  <text x="950" y="610" font-size="12" font-weight="bold" fill="#0c5460">체인 구성:</text>
  <text x="950" y="630" font-size="10" fill="#333">LangChain LCEL</text>
  <text x="950" y="645" font-size="10" fill="#333">Runnable 파이프라인</text>
  
  <!-- 하단 요약 박스 -->
  <rect x="150" y="1240" width="900" height="120" rx="10" fill="#f8f9fa" stroke="#6c757d" stroke-width="2"/>
  <text x="600" y="1270" font-size="15" font-weight="bold" text-anchor="middle">💡 시스템 특징</text>
  <text x="170" y="1300" font-size="12" fill="#333">✓ 하이브리드 검색: 벡터 유사도 + 그래프 관계 탐색</text>
  <text x="170" y="1320" font-size="12" fill="#333">✓ 컨텍스트 확장: 영화 정보를 배우 필모그래피까지 확장</text>
  <text x="170" y="1340" font-size="12" fill="#333">✓ 정확한 답변: 검색된 정보만 활용하여 환각(hallucination) 방지</text>
  
  <!-- 범례 -->
  <rect x="50" y="1420" width="280" height="140" rx="8" fill="white" stroke="#333" stroke-width="2"/>
  <text x="190" y="1445" font-size="14" font-weight="bold" text-anchor="middle">범례</text>
  <rect x="70" y="1460" width="40" height="25" rx="5" fill="url(#processGrad)"/>
  <text x="120" y="1477" font-size="11">처리 단계</text>
  <rect x="70" y="1495" width="40" height="25" rx="5" fill="url(#dbGrad)"/>
  <text x="120" y="1512" font-size="11">데이터베이스 작업</text>
  <rect x="70" y="1530" width="40" height="25" rx="5" fill="url(#resultGrad)"/>
  <text x="120" y="1547" font-size="11">결과 출력</text>
  
  <!-- 성능 지표 -->
  <rect x="380" y="1420" width="440" height="140" rx="8" fill="white" stroke="#333" stroke-width="2"/>
  <text x="600" y="1445" font-size="14" font-weight="bold" text-anchor="middle">⚡ 검색 파라미터</text>
  <text x="400" y="1475" font-size="11" fill="#333">• 벡터 검색: k=5 (상위 5개 영화)</text>
  <text x="400" y="1495" font-size="11" fill="#333">• 필모그래피: 각 배우당 최대 5개 작품</text>
  <text x="400" y="1515" font-size="11" fill="#333">• 임베딩 차원: text-embedding-3-small</text>
  <text x="400" y="1535" font-size="11" fill="#333">• LLM 설정: Temperature 0.0 (결정적 답변)</text>
  
  <!-- 데이터 흐름 화살표 강조 -->
  <rect x="870" y="1420" width="280" height="140" rx="8" fill="white" stroke="#333" stroke-width="2"/>
  <text x="1010" y="1445" font-size="14" font-weight="bold" text-anchor="middle">🔄 체인 구성</text>
  <text x="890" y="1475" font-size="11" fill="#333">context ← graph_path_search()</text>
  <text x="890" y="1495" font-size="11" fill="#333">question ← 사용자 쿼리</text>
  <text x="890" y="1520" font-size="11" fill="#333">↓</text>
  <text x="890" y="1540" font-size="11" fill="#333">Prompt → LLM → Parser → 답변</text>
  
  <!-- 워터마크 -->
  <text x="600" y="1780" font-size="10" text-anchor="middle" fill="#999">
    Graph-based RAG with Neo4j + LangChain + OpenAI
  </text>
</svg>